---
title: "GhostからWordpressへ （２） 〜ドメイン切り替え準備〜"
description: "[前回](http://tech.uribou.tokyo/ghost_to_wordpress_plan/)の続き **旧ドメインのTTL（Time To L..."
tags:
  - "ghost"
  - "Wordpress"
  - "ブログ"
categories:
  - programming
image: /images/software-developer.jpg
date: 2017-06-14T12:36:14.000Z
author: takashi
---



[前回](http://tech.uribou.tokyo/ghost_to_wordpress_plan/)の続き **旧ドメインのTTL（Time To Live）を最少にして、各地に散らばったDNSキャッシュ書き換え間隔が置き換わるのを待つ編** です。
さて唐突ですが、
## ドメインとは？
ドメインとは、お名前.com とかで購入できる、インターネット上の自分だけの住所を示すアレです。
<p align="center"><a href="//af.moshimo.com/af/c/click?a_id=783832&amp;p_id=109&amp;pc_id=109&amp;pl_id=2552&amp;guid=ON" target="_blank" rel="nofollow noopener"><img src="//image.moshimo.com/af-img/0045/000000002552.gif" width="250" height="250" style="border:none"></a><img src="//i.moshimo.com/af/i/impression?a_id=783832&amp;p_id=109&amp;pc_id=109&amp;pl_id=2552" width="1" height="1" style="border:none"></p>
このブログでいうところの **uribou.tokyo** ですね。
住所なので、他とかぶる名前を取得することは当然できません。
不動産と同じで、人気（知名度）のあるキーワードは早々に買われてしまうので、実際に使うのは先でもとりあえず買っておくといいのかも・・・？
実際、自分は当初 **[uribou.jp](http://www.uribou.jp)** を取ろうとしたんですが、茨城県桜川市真壁町にある、とってもお洒落な旅館が取得されていたので買えませんでした。・・・ここ泊まってみたい。
&gt; 見晴らしの丘 真壁 『うり坊』は茨城県桜川市にあります。重要伝統建築物群保存地区指定に選定された『真壁町』。まだまだ知られていないこの街の外れに 『うり坊』はあります。ちょっと高台で見晴らしは抜群です。隠れ家のように佇む当館を是非一度ご利用くださいませ。現在は期間を限定して営業しております。是非お問い合わせくださいませ。
![見晴らしの丘うり坊](https://farm5.staticflickr.com/4223/35309769036_d8d5c7bdaf_z_d.jpg)
話が逸れましたがそういうことで、価格も手頃な.tokyoを買うことにしました。
.tokyo ドメインは比較的新しいせいか、.comや.jp等と比較して安い上、人気ありそうなキーワードも意外と空いてます。
ドメイン | 1年目 | 2年目以降
------------- | -------------
.tokyo | 99円 | 920円
.com | 1円 | 1280円
.jp | 1円 | 2840円
**※上記価格は2017/6/16時点です**
一応[メリットデメリット？](https://www.qript.co.jp/blog/business/3196/)を見た上で購入しましょう。
## TTLとは？
ドメインは、それに紐づいたIPアドレスと対応付けたデータベースとして、DNS（Domain Name System）サーバが管理しています。
ネットワーク的に近場のDNSサーバ（インターネット回線のプロバイダ）が、目的のドメインのDNSサーバに問い合わせ、結果を保持（キャッシュ）しておく仕組みになっています。
アクセスしたいドメインに紐づいたIPアドレスって頻繁に変わるものではないので、アクセスするたびにDNSサーバに問い合わせてたら効率悪いので、DNSサーバは大抵キャッシュサーバも兼ねているわけです。
その結果をキャッシュしておく期間がTTL（Time To Live：生存期間）です。
<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">IPが変わるたび、TTL(Time To Live。 生存時間)の間、アクセスできない人が出てきますね。 IPが頻繁に変わる可能性があるなら機会損失大かも。 <a href="https://twitter.com/taka222">@taka222</a> ダイナミックDNSって固定IPに比べて決定的な欠点てあるのかな？</p>&mdash; 大澤日出男 (@ohsour) <a href="https://twitter.com/ohsour/status/7018192150">2009年12月25日</a></blockquote>

↑これはDDNS（Dynamic DNS）に関する話ですが、TTLをいじろうとしている理由は同じで、機会損失期間を最小にするためです。
例えばTTLを１分に設定しておけば、DNSのキャッシュ情報の寿命が１分で切れるので、１分毎にDNSサーバへ問い合わせが発生します。
なので、切り替え時にアクセス不可となる時間は最大でも１分に限定されるわけです。
## TTL設定方法
ということで、ようやくTTL設定の具体例を示します。
お名前.comで購入したドメインなので、お名前.comの管理画面で行います。
### ネームサーバーの設定
お名前.comの管理画面にログインした後、ネームサーバの設定で **DNS関連機能の設定** に行きましょう。
![ネームサーバの設定](https://c1.staticflickr.com/5/4208/35163577002_4532e4e9f3_o.png)
### ドメインの選択
所有しているドメイン一覧が表示されます。
切り替えようとしているドメインを選択後、次へ。
![所有しているドメイン一覧](https://c1.staticflickr.com/5/4284/34943004960_a33deca288_o.png)
### DNSレコード設定
**DNSレコード設定を利用する** 横の設定ボタンを押しましょう。
![DNSレコード設定を選択](https://c1.staticflickr.com/5/4233/35163577182_0fec5745b4_b.jpg)
### TTL設定
やっと本題。
お名前.comのTTLはデフォルトで3600秒に設定されているので、
![旧ドメインのTTLデフォルト](https://c1.staticflickr.com/5/4263/35163577492_37d31509e8_b.jpg)
これを最小時間の60秒に設定します。
60秒未満に設定しようとすると「設定できないよ」と注意されます。
![旧ドメインのTTLを最小設定に](https://c1.staticflickr.com/5/4275/35200692521_e2847510bc_b.jpg)
あとは次へ次へ…と進んでいけば無事設定完了です　が、忘れてはならないのが、 **ここで設定した瞬間に、変更後のTTL時間でDNS問い合わせが発生するわけではない** ということです。
変更前のTTLは3600秒だったので、世界中のDNSサーバはそれに従って3600秒の間はキャッシュ情報を使い、問い合わせは発生しません。
3600秒後にキャッシュの生存期間が終了し、初めて新しいTTL設定60秒が有効になります。
ということで、 **TTL設定後は、変更前のTTL時間だけ待つ** のをお忘れなく。
## そもそも、TTL設定は必要なの？
[前回](http://tech.uribou.tokyo/ghost_to_wordpress_plan/)も触れた通り、目的は **新ドメインへの移行** です。
てことは、旧ドメインのブログにアクセスしたら新ドメインのブログに[301リダイレクト](https://www.seohacks.net/basic/terms/301_redirect/)すれば良いだけで、DNSサーバのTTLをいじる必要なんてないじゃん。
&gt; 301リダイレクトは、URLが恒久的に変更された場合に用いられる転送処理のステータスコードです。
&gt; （中略）
&gt; 301リダイレクトによって転送される場合、検索エンジンは転送前のURLが持っていた被リンク等の評価を、転送先のURLに引き継がせます。
という指摘をもらいそうなので言い訳しておくと…。
もちろん当初想定はこれでしたが、旧ブログがnodejsのGhost、それを稼働させたVPSの選択ミス、さらには管理者のスキル不足が重なり、そう簡単にはいきませんでした…。
詳細はGhostからWordpressへ（４）に書く予定なので、そちらをご覧ください。
取り急ぎ、こんな顛末です。
* **理想のステップ**
1. *新ドメインでブログ立ち上げ*
2. *旧ドメインのブログのデータを新ブログにインポート*
3. *旧ドメインのサーバを新ドメインへのリダイレクト専用サーバにする*
4. *旧ブログへのアクセスは新ブログへリダイレクトされる*
* **実際のステップ**
1. *新ドメインでブログ立ち上げ*
2. *旧ドメインのブログのデータを新ブログにインポート*
3. *リダイレクト専用サーバを新規立ち上げ*
4. *旧ドメインをリダイレクト専用サーバに割り当てる*
5. *リダイレクト専用サーバへのアクセスは新ブログへリダイレクトされる*
そんなわけで、上記 **実際のステップ** の4.をするための下準備が今回の記事です。
長くなりそうだ・・・。
次回へ続く。
